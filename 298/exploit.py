#!/usr/bin/env python3

import http.client
import random
import urllib.parse


def randint_compat(lo, hi):
    return lo + int(random.random() * (hi + 1 - lo))


def generate_combination():
    combination = []
    for _ in range(3):
        numbers = ""
        for _ in range(10):
            rand_num = randint_compat(0, 99)
            if rand_num < 10:
                numbers += "0"
            numbers += str(rand_num)
            if _ != 9:
                numbers += "-"
        combination.append(numbers)
    return combination


conn = http.client.HTTPConnection("challenges.ringzer0team.com:10298")
conn.request("GET", "/")
resp = conn.getresponse()
cookie = resp.getheader("Set-Cookie").split(";")[0]
conn.close()

conn = http.client.HTTPConnection("challenges.ringzer0team.com:10298")
params = urllib.parse.urlencode({
    "combination": "12-34-56-78-91-23-45-67-89-12"
})
headers = {
    "Content-type": "application/x-www-form-urlencoded",
    "Cookie": cookie
}
conn.request("POST", "/", params, headers)
resp = conn.getresponse()
html = resp.read().decode()
last_win = html.split("The winning combination was : ")[1][0:29]
conn.close()

for i in range(32768):
    random.seed(i)
    combination = generate_combination()
    if combination[0] == last_win:
        break

conn = http.client.HTTPConnection("challenges.ringzer0team.com:10298")
params = urllib.parse.urlencode({
    "combination": combination[1]
})
headers = {
    "Content-type": "application/x-www-form-urlencoded",
    "Cookie": cookie
}
conn.request("POST", "/", params, headers)
resp = conn.getresponse()
html = resp.read().decode()
conn.close()

print(html)
